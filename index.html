<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Tools Ultimate</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #D0BCFF;
            --on-primary: #381E72;
            --surface: rgba(30, 30, 30, 0.65);
            --surface-active: rgba(60, 60, 60, 0.85);
            --background: #121212;
            --text: #E6E1E5;
            --radius: 20px;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

        body {
            font-family: 'Heebo', sans-serif;
            margin: 0; padding: 15px;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            background-attachment: fixed; background-size: cover;
            color: var(--text);
            transition: background 0.5s;
        }

        /* Dynamic Backgrounds */
        .bg-1 { background: #0f0c29; background: linear-gradient(to right, #24243e, #302b63, #0f0c29); }
        .bg-2 { background: linear-gradient(to bottom, #323232 0%, #3F5EFB 40%, #FC466B 100%); }
        .bg-3 { background: linear-gradient(15deg, #13547a 0%, #80d0c7 100%); }
        .bg-4 { background: radial-gradient(circle at center, #eb3349 0%, #f45c43 100%); }

        header {
            width: 100%; max-width: 500px;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; z-index: 2;
        }
        h1 { font-size: 1.6rem; font-weight: 700; margin: 0; text-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        .theme-btn {
            background: rgba(255,255,255,0.2); border: none; width: 40px; height: 40px;
            border-radius: 50%; cursor: pointer; font-size: 1.2rem; backdrop-filter: blur(5px);
        }

        /* Grid */
        .grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
            width: 100%; max-width: 500px; padding-bottom: 80px;
        }

        /* Cards */
        .card {
            background: var(--surface); backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: var(--radius);
            padding: 15px 10px;
            height: 110px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; cursor: pointer; transition: transform 0.15s;
        }
        .card:active { transform: scale(0.95); background: var(--surface-active); }
        .icon { font-size: 2rem; margin-bottom: 8px; }
        .card h3 { font-size: 0.85rem; margin: 0; font-weight: 400; }

        /* Overlay Tools */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #121212; z-index: 100;
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0, 0.2, 1);
            display: flex; flex-direction: column;
        }
        .overlay.active { transform: translateY(0); }
        
        .navbar {
            padding: 15px; display: flex; align-items: center;
            background: rgba(255,255,255,0.05); border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .back-btn { background: none; border: none; color: white; font-size: 1.5rem; padding: 5px 15px; }
        .nav-title { font-size: 1.2rem; font-weight: bold; margin-right: 10px; }
        
        .content {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            position: relative; overflow-y: auto; padding: 20px;
        }

        /* --- Specific Tools CSS --- */
        /* Camera/Mirror */
        video { width: 100%; height: 100%; object-fit: cover; }
        .mirror-mode { transform: scaleX(-1); }

        /* Level */
        .level-box {
            width: 250px; height: 250px; border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%; position: relative; background: rgba(255,255,255,0.05);
        }
        .bubble {
            width: 40px; height: 40px; background: #00ff88; border-radius: 50%;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            box-shadow: 0 0 15px #00ff88;
        }

        /* Ruler */
        .ruler-container {
            width: 100%; height: 100%; display: flex; align-items: flex-start;
            background: #222; position: relative; overflow: hidden;
        }
        .cm-mark {
            height: 40%; width: 1px; background: white; position: absolute; top: 0;
        }
        .cm-num {
            position: absolute; top: 45%; color: white; font-size: 0.8rem; transform: translateX(-50%);
        }
        .mm-mark {
            height: 20%; width: 1px; background: rgba(255,255,255,0.5); position: absolute; top: 0;
        }

        /* Battery */
        .battery-shape {
            width: 120px; height: 200px; border: 8px solid white; border-radius: 20px;
            padding: 5px; position: relative; display: flex; align-items: flex-end;
        }
        .battery-shape:before {
            content: ''; position: absolute; top: -18px; left: 35px; width: 34px; height: 12px; background: white;
            border-radius: 4px 4px 0 0;
        }
        .battery-fill {
            width: 100%; background: #00ff88; border-radius: 10px;
            transition: height 0.5s;
        }

        /* General Buttons */
        .action-btn {
            background: var(--primary); color: var(--on-primary);
            border: none; padding: 15px 30px; border-radius: 30px;
            font-size: 1.1rem; font-weight: bold; margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        input, textarea {
            width: 100%; background: #333; border: none; color: white;
            padding: 15px; border-radius: 15px; font-size: 1.1rem; margin-bottom: 10px;
        }

    </style>
</head>
<body class="bg-1">

    <header>
        <h1>Smart Tools <span style="font-size:0.8rem; opacity:0.7">Ultimate</span></h1>
        <button class="theme-btn" onclick="toggleTheme()">ğŸ¨</button>
    </header>

    <div class="grid">
        <div class="card" onclick="openTool('mirror')"><div class="icon">ğŸª</div><h3>××¨××”</h3></div>
        <div class="card" onclick="openTool('battery')"><div class="icon">ğŸ”‹</div><h3>×¡×•×œ×œ×”</h3></div>
        <div class="card" onclick="openTool('ruler')"><div class="icon">ğŸ“</div><h3>×¡×¨×’×œ</h3></div>
        
        <div class="card" onclick="openTool('vibrate')"><div class="icon">ğŸ“³</div><h3>×¨×˜×˜</h3></div>
        <div class="card" onclick="openTool('tts')"><div class="icon">ğŸ—£ï¸</div><h3>×”×§×¨××”</h3></div>
        <div class="card" onclick="openTool('light')"><div class="icon">ğŸ’¡</div><h3>×¤× ×¡</h3></div>

        <div class="card" onclick="openTool('compass')"><div class="icon">ğŸ§­</div><h3>××¦×¤×Ÿ</h3></div>
        <div class="card" onclick="openTool('level')"><div class="icon">ğŸ’§</div><h3>×¤×œ×¡</h3></div>
        <div class="card" onclick="openTool('magnifier')"><div class="icon">ğŸ”</div><h3>×–×›×•×›×™×ª</h3></div>

        <div class="card" onclick="openTool('noise')"><div class="icon">ğŸ”Š</div><h3>×¨×¢×©</h3></div>
        <div class="card" onclick="openTool('stopwatch')"><div class="icon">â±ï¸</div><h3>×¡×˜×•×¤×¨</h3></div>
        <div class="card" onclick="openTool('notes')"><div class="icon">ğŸ“</div><h3>×¤×ª×§×™×</h3></div>
    </div>

    <div id="mirror" class="overlay">
        <div class="navbar"><button class="back-btn" onclick="closeTool('mirror')">âœ</button><span class="nav-title">××¨××”</span></div>
        <div class="content" style="padding:0; background:black;">
            <video id="mirrorVideo" autoplay playsinline class="mirror-mode"></video>
        </div>
    </div>

    <div id="battery" class="overlay">
        <div class="navbar"><button class="back-btn" onclick="closeTool('battery')">âœ</button><span class="nav-title">××¦×‘ ×¡×•×œ×œ×”</span></div>
        <div class="content">
            <div class="battery-shape">
                <div id="batLevel" class="battery-fill" style="height: 50%;"></div>
            </div>
            <h2 id="batText" style="margin-top: 20px; font-size: 2rem;">--%</h2>
            <p id="batStatus" style="opacity: 0.7;">×˜×•×¢×Ÿ × ×ª×•× ×™×...</p>
        </div>
    </div>

    <div id="ruler" class="overlay">
        <div class="navbar"><button class="back-btn" onclick="closeTool('ruler')">âœ</button><span class="nav-title">×¡×¨×’×œ (××©×•×¢×¨)</span></div>
        <div class="content" style="padding:0; align-items: flex-start;">
            <div id="rulerCanvas" class="ruler-container"></div>
            <p style="position: absolute; bottom: 20px; right: 20px; opacity:0.5; font-size: 0.8rem;">*×ª×œ×•×™ ×‘×’×•×“×œ ××¡×š ×¤×™×–×™</p>
        </div>
    </div>

    <div id="vibrate" class="overlay">
        <div class="navbar"><button class="back-btn" onclick="closeTool('vibrate')">âœ</button><span class="nav-title">×¨×˜×˜</span></div>
        <div class="content">
            <div style="font-size: 5rem;">ğŸ“³</div>
            <p>×¢×•×‘×“ ×‘×¢×™×§×¨ ×‘×× ×“×¨×•××™×“</p>
            <button class="action-btn" onclick="navigator.vibrate(200)">×¨×˜×˜ ×§×¦×¨</button>
            <button class="action-btn" onclick="navigator.vibrate([100,50,100,50,500])" style="background:#ff4b4b; margin-top:10px;">×¨×˜×˜ ××§×¦×‘</button>
        </div>
    </div>

    <div id="tts" class="overlay">
        <div class="navbar"><button class="back-btn" onclick="closeTool('tts')">âœ</button><span class="nav-title">×”×§×¨××ª ×˜×§×¡×˜</span></div>
        <div class="content">
            <textarea id="ttsInput" rows="5" placeholder="×›×ª×•×‘ ×›××Ÿ ××©×”×•..."></textarea>
            <button class="action-btn" onclick="speakText()">ğŸ”Š ×”×§×¨×</button>
        </div>
    </div>

    <div id="magnifier" class="overlay">
        <div class="navbar"><button class="back-btn" onclick="closeTool('magnifier')">âœ</button><span class="nav-title">×–×›×•×›×™×ª ××’×“×œ×ª</span></div>
        <div class="content" style="padding:0; background:black;"><video id="magVideo" autoplay playsinline></video></div>
    </div>

    <div id="level" class="overlay">
        <div class="navbar"><button class="back-btn" onclick="closeTool('level')">âœ</button><span class="nav-title">×¤×œ×¡</span></div>
        <div class="content">
            <button class="action-btn" id="sensorBtn" onclick="reqSensors()">×”×¤×¢×œ ×—×™×™×©× ×™×</button>
            <div class="level-box">
                <div style="position:absolute; top:50%; left:50%; width:10px; height:10px; background:rgba(255,255,255,0.5); transform:translate(-50%,-50%); border-radius:50%;"></div>
                <div id="bubble" class="bubble"></div>
            </div>
            <p id="levelVal" style="margin-top:20px">0Â°</p>
        </div>
    </div>

    <div id="compass" class="overlay">
        <div class="navbar"><button class="back-btn" onclick="closeTool('compass')">âœ</button><span class="nav-title">××¦×¤×Ÿ</span></div>
        <div class="content">
            <button class="action-btn" id="compassBtn" onclick="reqSensors()">×”×¤×¢×œ ×—×™×™×©× ×™×</button>
            <div id="compassDial" style="font-size: 8rem; transition: transform 0.2s;">ğŸ§­</div>
            <h2 id="compassVal">0Â°</h2>
        </div>
    </div>

    <div id="light" class="overlay" style="background: white;">
        <div style="position: absolute; bottom: 50px; width: 100%; text-align: center;">
            <button onclick="closeTool('light')" style="padding: 10px 30px; border-radius: 20px; border:none; background: #333; color: white;">×›×‘×” ×¤× ×¡</button>
        </div>
    </div>

    <div id="stopwatch" class="overlay">
        <div class="navbar"><button class="back-btn" onclick="closeTool('stopwatch')">âœ</button><span class="nav-title">×¡×˜×•×¤×¨</span></div>
        <div class="content">
            <div id="swDisplay" style="font-size: 4rem; font-variant-numeric: tabular-nums;">00:00</div>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button class="action-btn" onclick="startSW()" style="background:#4CAF50">×”×ª×—×œ</button>
                <button class="action-btn" onclick="stopSW()" style="background:#f44336">×¢×¦×•×¨</button>
                <button class="action-btn" onclick="resetSW()" style="background:#555">××¤×¡</button>
            </div>
        </div>
    </div>

    <div id="noise" class="overlay">
        <div class="navbar"><button class="back-btn" onclick="closeTool('noise')">âœ</button><span class="nav-title">××“ ×¨×¢×©</span></div>
        <div class="content">
            <button class="action-btn" id="micBtn" onclick="initMic()">×”×¤×¢×œ ××™×§×¨×•×¤×•×Ÿ</button>
            <div style="width:50px; height:300px; background:#333; border-radius:25px; overflow:hidden; display:flex; align-items:flex-end;">
                <div id="noiseBar" style="width:100%; height:0%; background: linear-gradient(to top, #00ff88, #ffff00, #ff0000); transition: height 0.1s;"></div>
            </div>
        </div>
    </div>

    <div id="notes" class="overlay">
        <div class="navbar"><button class="back-btn" onclick="closeTool('notes')">âœ</button><span class="nav-title">×¤×ª×§×™×</span></div>
        <div class="content">
            <textarea id="noteArea" style="height:100%; background: transparent; resize:none;" placeholder="×›×ª×•×‘ ×›××Ÿ..."></textarea>
        </div>
    </div>


    <script>
        // --- CORE ---
        let bgIdx = 1;
        function toggleTheme() {
            bgIdx = bgIdx >= 4 ? 1 : bgIdx + 1;
            document.body.className = 'bg-' + bgIdx;
        }

        function openTool(id) {
            document.getElementById(id).classList.add('active');
            // Init Specifics
            if(id === 'mirror') startCam('mirrorVideo', 'user');
            if(id === 'magnifier') startCam('magVideo', 'environment');
            if(id === 'battery') initBattery();
            if(id === 'ruler') drawRuler();
            if(id === 'notes') document.getElementById('noteArea').value = localStorage.getItem('s_notes') || '';
        }

        function closeTool(id) {
            document.getElementById(id).classList.remove('active');
            stopCam();
            if(id === 'noise') stopMic();
            if(id === 'notes') localStorage.setItem('s_notes', document.getElementById('noteArea').value);
        }

        // --- CAMERA ---
        let stream;
        async function startCam(elemId, faceMode) {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: faceMode } });
                document.getElementById(elemId).srcObject = stream;
            } catch(e) { console.log(e); }
        }
        function stopCam() { if(stream) stream.getTracks().forEach(t=>t.stop()); }

        // --- SENSORS ---
        function reqSensors() {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().then(r => {
                    if(r==='granted') window.addEventListener('deviceorientation', handleMotion);
                });
            } else { window.addEventListener('deviceorientation', handleMotion); }
            document.getElementById('sensorBtn').style.display='none';
            document.getElementById('compassBtn').style.display='none';
        }

        function handleMotion(e) {
            // Level
            let x = Math.max(-110, Math.min(110, e.gamma * 2));
            let y = Math.max(-110, Math.min(110, e.beta * 2));
            document.getElementById('bubble').style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
            document.getElementById('levelVal').innerText = `${Math.round(e.beta)}Â°`;

            // Compass
            let c = e.webkitCompassHeading || Math.abs(e.alpha - 360);
            document.getElementById('compassDial').style.transform = `rotate(${-c}deg)`;
            document.getElementById('compassVal').innerText = Math.round(c) + 'Â°';
        }

        // --- BATTERY ---
        function initBattery() {
            if(navigator.getBattery) {
                navigator.getBattery().then(bat => {
                    updateBat(bat);
                    bat.addEventListener('levelchange', ()=>updateBat(bat));
                    bat.addEventListener('chargingchange', ()=>updateBat(bat));
                });
            } else { document.getElementById('batStatus').innerText = "×œ× × ×ª××š ×‘×“×¤×“×¤×Ÿ ×–×”"; }
        }
        function updateBat(b) {
            let level = Math.round(b.level * 100);
            document.getElementById('batLevel').style.height = level + '%';
            document.getElementById('batText').innerText = level + '%';
            document.getElementById('batStatus').innerText = b.charging ? "âš¡ ×‘×˜×¢×™× ×”" : "×œ× ×‘×˜×¢×™× ×”";
        }

        // --- RULER ---
        function drawRuler() {
            const el = document.getElementById('rulerCanvas');
            el.innerHTML = '';
            // Approx 38px per cm (standard DPI varies, this is an estimate)
            const pxPerCm = 38; 
            const totalCm = Math.ceil(window.innerHeight / pxPerCm);
            
            for(let i=0; i<totalCm; i++) {
                let d = document.createElement('div');
                d.className = 'cm-mark';
                d.style.top = (i * pxPerCm) + 'px';
                el.appendChild(d);
                
                let num = document.createElement('div');
                num.className = 'cm-num';
                num.innerText = i;
                num.style.top = (i * pxPerCm + 5) + 'px';
                el.appendChild(num);

                // mm marks
                for(let m=1; m<10; m++) {
                    let mm = document.createElement('div');
                    mm.className = 'mm-mark';
                    mm.style.top = (i * pxPerCm + (m * 3.8)) + 'px';
                    el.appendChild(mm);
                }
            }
        }

        // --- TTS ---
        function speakText() {
            let txt = document.getElementById('ttsInput').value;
            if(!txt) return;
            let u = new SpeechSynthesisUtterance(txt);
            u.lang = 'he-IL';
            speechSynthesis.speak(u);
        }

        // --- STOPWATCH ---
        let swT, swI;
        function startSW() { if(!swI) { let s = Date.now() - (swT || 0); swI = setInterval(()=>{ swT = Date.now() - s; 
            document.getElementById('swDisplay').innerText = (swT/1000).toFixed(2); }, 30); } }
        function stopSW() { clearInterval(swI); swI = null; }
        function resetSW() { stopSW(); swT=0; document.getElementById('swDisplay').innerText = "00:00"; }

        // --- NOISE ---
        let ac;
        async function initMic() {
            try {
                let s = await navigator.mediaDevices.getUserMedia({audio:true});
                ac = new AudioContext();
                let src = ac.createMediaStreamSource(s);
                let an = ac.createAnalyser();
                let sc = ac.createScriptProcessor(2048,1,1);
                src.connect(an); an.connect(sc); sc.connect(ac.destination);
                sc.onaudioprocess = () => {
                    let arr = new Uint8Array(an.frequencyBinCount);
                    an.getByteFrequencyData(arr);
                    let avg = arr.reduce((a,b)=>a+b) / arr.length;
                    document.getElementById('noiseBar').style.height = (avg * 1.5) + '%';
                };
                document.getElementById('micBtn').style.display='none';
            } catch(e){ alert('Microphone error'); }
        }
        function stopMic() { if(ac) ac.close(); }

    </script>
</body>
    </html>
